(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[556],{693:function(e,t,s){Promise.resolve().then(s.bind(s,3488))},3488:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return X}});var a=s(7573),l=s(7653),n=s(1695),r=s(4382),i=s(5118),c=s(8688);let o=s(4859).env.NEXT_PUBLIC_API_URL||"http://localhost:4000",d=null,x=null,m=null;function u(e,t){let s=(0,l.useRef)(new Map),a=(0,l.useCallback)((e,t)=>(s.current.has(e)||s.current.set(e,new Set),s.current.get(e).add(t),()=>{var a;null===(a=s.current.get(e))||void 0===a||a.delete(t)}),[]),n=(0,l.useCallback)((e,t)=>{null==d||d.emit(e,t)},[]);return(0,l.useEffect)(()=>{if(!e||!t)return;(x!==e||m!==t)&&(null==d||d.disconnect(),d=null),d||(x=e,m=t,(d=(0,c.io)(o,{withCredentials:!0,auth:{roomId:e,userId:t}})).on("connect",()=>{console.log("\uD83D\uDD0C Socket connected:",null==d?void 0:d.id)}),d.on("disconnect",()=>{console.log("\uD83D\uDD0C Socket disconnected")}));let a=e=>{var t;null===(t=s.current.get("message.new"))||void 0===t||t.forEach(t=>t(e))},l=e=>{var t;null===(t=s.current.get("event.new"))||void 0===t||t.forEach(t=>t(e))},n=e=>{var t;null===(t=s.current.get("state.patch"))||void 0===t||t.forEach(t=>t(e))};return d.on("message.new",a),d.on("event.new",l),d.on("state.patch",n),()=>{null==d||d.off("message.new",a),null==d||d.off("event.new",l),null==d||d.off("state.patch",n)}},[e,t]),{on:a,emit:n,socket:d}}var h=s(1836),p=s(5721),f=s(2482),b=s(4737),v=s(6604),g=s(607);function j(e){let{roomId:t,userId:s,userName:n,isAdmin:r,tasks:c}=e,[o,d]=(0,l.useState)([]),[x,m]=(0,l.useState)(""),[j,N]=(0,l.useState)(!1),[w,y]=(0,l.useState)(!1),[k,C]=(0,l.useState)(!0),Z=(0,l.useRef)(null),{on:S}=u(t,s);(0,l.useEffect)(()=>{i.Mp.list(t,"master").then(e=>d(e.data)).catch(console.error).finally(()=>C(!1))},[t]),(0,l.useEffect)(()=>S("message.new",e=>{"master"===e.channel&&d(t=>t.find(t=>t.id===e.id)?t:[...t,e])}),[S]),(0,l.useEffect)(()=>{var e;null===(e=Z.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[o]);let I=async()=>{if(!x.trim()||j)return;let e=x.trim();m(""),N(!0);try{await i.Mp.sendMaster(t,e)}catch(t){console.error(t),m(e)}finally{N(!1)}},D=async()=>{y(!0);try{await i.I2.plan(t)}catch(e){console.error(e)}finally{y(!1)}},A=e=>!!e.senderAgentId,E=e=>e.senderUserId===s;return(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[(0,a.jsxs)("div",{className:"px-4 py-3 border-b border-white/5 flex items-center gap-3 flex-shrink-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-slate-400",children:[(0,a.jsx)(h.Z,{className:"w-4 h-4 text-brand-400"}),(0,a.jsx)("span",{children:"Master Agent — shared channel"})]}),r&&0===c.length&&(0,a.jsxs)("button",{onClick:D,disabled:w,className:"btn-primary ml-auto flex items-center gap-2 text-xs",children:[w?(0,a.jsx)(p.Z,{className:"w-3.5 h-3.5 animate-spin"}):(0,a.jsx)(f.Z,{className:"w-3.5 h-3.5"}),"Generate Plan"]})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto px-4 py-4 space-y-3",children:[k?(0,a.jsx)("div",{className:"flex justify-center pt-8",children:(0,a.jsx)(p.Z,{className:"w-5 h-5 animate-spin text-brand-500"})}):0===o.length?(0,a.jsxs)("div",{className:"text-center text-slate-500 text-sm pt-8",children:[(0,a.jsx)(h.Z,{className:"w-8 h-8 text-slate-600 mx-auto mb-2"}),"No messages yet. Ask the Master Agent anything, or"," ",r?"generate a plan to get started.":"wait for the admin to generate a plan."]}):o.map(e=>{var t,s,l,n,r;return(0,a.jsxs)("div",{className:(0,g.Z)("flex gap-3",E(e)&&!A(e)?"flex-row-reverse":"flex-row"),children:[(0,a.jsx)("div",{className:(0,g.Z)("w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0",A(e)?"bg-brand-600 text-white":"bg-slate-700 text-slate-300"),children:A(e)?"M":null!==(n=null===(s=e.senderUser)||void 0===s?void 0:null===(t=s.name)||void 0===t?void 0:t[0])&&void 0!==n?n:"?"}),(0,a.jsxs)("div",{className:"max-w-[75%]",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)("span",{className:"text-xs text-slate-500",children:A(e)?"Master Agent":null!==(r=null===(l=e.senderUser)||void 0===l?void 0:l.name)&&void 0!==r?r:"Unknown"}),(0,a.jsx)("span",{className:"text-xs text-slate-600",children:(0,v.Q)(new Date(e.createdAt),{addSuffix:!0})})]}),(0,a.jsx)("div",{className:(0,g.Z)("rounded-2xl px-4 py-2.5 text-sm whitespace-pre-wrap",A(e)?"bg-brand-600/15 border border-brand-500/20 text-slate-200 rounded-tl-sm":E(e)?"bg-brand-600 text-white rounded-tr-sm":"bg-surface-800 text-slate-200 rounded-tl-sm"),children:e.content})]})]},e.id)}),(0,a.jsx)("div",{ref:Z})]}),(0,a.jsx)("div",{className:"px-4 py-3 border-t border-white/5 flex-shrink-0",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{className:"input flex-1",placeholder:"Message the Master Agent or team...",value:x,onChange:e=>m(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),I())},disabled:j}),(0,a.jsx)("button",{onClick:I,className:"btn-primary px-3 flex items-center justify-center",disabled:j||!x.trim(),children:j?(0,a.jsx)(p.Z,{className:"w-4 h-4 animate-spin"}):(0,a.jsx)(b.Z,{className:"w-4 h-4"})})]})})]})}var N=s(7686),w=s(7066),y=s(1351),k=s(1063);let C={todo:"bg-slate-700 text-slate-300",in_progress:"bg-blue-600/20 text-blue-300",blocked:"bg-red-600/20 text-red-300",review:"bg-yellow-600/20 text-yellow-300",done:"bg-green-600/20 text-green-300"};function Z(e){let{roomId:t,userId:s,userName:n,tasks:r}=e,[c,o]=(0,l.useState)([]),[d,x]=(0,l.useState)(""),[m,h]=(0,l.useState)(!1),[f,j]=(0,l.useState)(!0),[Z,S]=(0,l.useState)(null),[I,D]=(0,l.useState)(null),[A,E]=(0,l.useState)(""),M=(0,l.useRef)(null),{on:R}=u(t,s),U=r.filter(e=>e.assignedUserId===s);(0,l.useEffect)(()=>{i.Mp.list(t,"worker").then(e=>o(e.data)).catch(console.error).finally(()=>j(!1))},[t]),(0,l.useEffect)(()=>R("message.new",e=>{"worker"===e.channel&&e.ownerUserId===s&&o(t=>t.find(t=>t.id===e.id)?t:[...t,e])}),[R,s]),(0,l.useEffect)(()=>{var e;null===(e=M.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[c]);let _=async()=>{if(!d.trim()||m)return;let e=d.trim();x(""),h(!0);try{await i.Mp.sendWorker(t,e)}catch(t){console.error(t),x(e)}finally{h(!1)}},P=async(e,s)=>{try{await i.Mp.sendMaster(t,s,e),S(null)}catch(e){console.error(e)}},T=async e=>{await i.lC.updateStatus(e,"done")},B=async e=>{A.trim()&&(await i.lC.updateStatus(e,"blocked",A),D(null),E(""))},O=e=>!!e.senderAgentId,V=e=>e.senderUserId===s&&!e.senderAgentId;return(0,a.jsxs)("div",{className:"h-full flex gap-0",children:[(0,a.jsxs)("div",{className:"w-64 border-r border-white/5 flex flex-col flex-shrink-0 hidden lg:flex",children:[(0,a.jsxs)("div",{className:"px-3 py-3 border-b border-white/5 flex items-center gap-2",children:[(0,a.jsx)(N.Z,{className:"w-3.5 h-3.5 text-slate-500"}),(0,a.jsx)("span",{className:"text-xs text-slate-400 font-medium",children:"My Tasks"})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-2 space-y-2",children:0===U.length?(0,a.jsx)("p",{className:"text-xs text-slate-500 px-2 py-2",children:"No tasks assigned yet."}):U.map(e=>(0,a.jsxs)("div",{className:"card p-3 space-y-2",children:[(0,a.jsx)("div",{className:"flex items-start gap-2",children:(0,a.jsx)("span",{className:"badge text-xs ".concat(C[e.status]),children:e.status})}),(0,a.jsx)("p",{className:"text-xs text-white font-medium leading-tight",children:e.title}),e.blockedReason&&(0,a.jsxs)("p",{className:"text-xs text-red-400",children:["⚠ ",e.blockedReason]}),(0,a.jsxs)("div",{className:"flex gap-1 pt-1",children:["done"!==e.status&&(0,a.jsxs)("button",{onClick:()=>T(e.id),className:"flex items-center gap-1 text-xs text-green-400 hover:text-green-300 transition-colors",children:[(0,a.jsx)(w.Z,{className:"w-3 h-3"}),"Done"]}),"blocked"!==e.status&&(0,a.jsxs)("button",{onClick:()=>D(e.id),className:"flex items-center gap-1 text-xs text-red-400 hover:text-red-300 transition-colors ml-auto",children:[(0,a.jsx)(y.Z,{className:"w-3 h-3"}),"Block"]})]}),I===e.id&&(0,a.jsxs)("div",{className:"space-y-1.5 pt-1",children:[(0,a.jsx)("input",{className:"input text-xs",placeholder:"Reason for blocking...",value:A,onChange:e=>E(e.target.value)}),(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsx)("button",{onClick:()=>D(null),className:"text-xs text-slate-500 hover:text-white px-2",children:"Cancel"}),(0,a.jsx)("button",{onClick:()=>B(e.id),className:"text-xs btn-primary py-1 px-2",children:"Confirm"})]})]})]},e.id))})]}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col min-w-0",children:[(0,a.jsxs)("div",{className:"px-4 py-3 border-b border-white/5 flex items-center gap-2 flex-shrink-0",children:[(0,a.jsx)(N.Z,{className:"w-3.5 h-3.5 text-slate-500"}),(0,a.jsx)("span",{className:"text-sm text-slate-400",children:"Private Worker Agent"}),(0,a.jsx)("span",{className:"ml-auto text-xs text-slate-600",children:"Only you can see this"})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto px-4 py-4 space-y-3",children:[f?(0,a.jsx)("div",{className:"flex justify-center pt-8",children:(0,a.jsx)(p.Z,{className:"w-5 h-5 animate-spin text-brand-500"})}):0===c.length?(0,a.jsxs)("div",{className:"text-center text-slate-500 text-sm pt-8",children:[(0,a.jsx)(N.Z,{className:"w-8 h-8 text-slate-600 mx-auto mb-2"}),"Start a private conversation with your Worker Agent.",(0,a.jsx)("br",{}),"Ask for help with your tasks, code review, or architecture advice."]}):c.map(e=>(0,a.jsxs)("div",{className:(0,g.Z)("flex gap-3 group",V(e)?"flex-row-reverse":"flex-row"),children:[(0,a.jsx)("div",{className:(0,g.Z)("w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0",O(e)?"bg-emerald-700 text-white":"bg-slate-700 text-slate-300"),children:O(e)?"W":n[0]}),(0,a.jsxs)("div",{className:"max-w-[75%]",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)("span",{className:"text-xs text-slate-500",children:O(e)?"Worker Agent":"You"}),(0,a.jsx)("span",{className:"text-xs text-slate-600",children:(0,v.Q)(new Date(e.createdAt),{addSuffix:!0})}),O(e)&&(0,a.jsxs)("button",{onClick:()=>P(e.id,e.content),className:"text-xs text-slate-600 hover:text-brand-400 transition-colors opacity-0 group-hover:opacity-100 flex items-center gap-1",title:"Share to Master channel",children:[(0,a.jsx)(k.Z,{className:"w-3 h-3"}),"Share"]})]}),(0,a.jsx)("div",{className:(0,g.Z)("rounded-2xl px-4 py-2.5 text-sm whitespace-pre-wrap",O(e)?"bg-emerald-600/10 border border-emerald-500/20 text-slate-200 rounded-tl-sm":"bg-brand-600 text-white rounded-tr-sm"),children:e.content})]})]},e.id)),(0,a.jsx)("div",{ref:M})]}),(0,a.jsx)("div",{className:"px-4 py-3 border-t border-white/5 flex-shrink-0",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{className:"input flex-1",placeholder:"Ask your agent for help...",value:d,onChange:e=>x(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),_())},disabled:m}),(0,a.jsx)("button",{onClick:_,className:"btn-primary px-3",disabled:m||!d.trim(),children:m?(0,a.jsx)(p.Z,{className:"w-4 h-4 animate-spin"}):(0,a.jsx)(b.Z,{className:"w-4 h-4"})})]})})]})]})}var S=s(5555),I=s(54),D=s(8333),A=s(9901),E=s(9458);let M={todo:{label:"To Do",color:"bg-slate-700 text-slate-300",icon:S.Z},in_progress:{label:"In Progress",color:"bg-blue-600/20 text-blue-300",icon:S.Z},blocked:{label:"Blocked",color:"bg-red-600/20 text-red-300",icon:I.Z},review:{label:"In Review",color:"bg-yellow-600/20 text-yellow-300",icon:D.Z},done:{label:"Done",color:"bg-green-600/20 text-green-300",icon:A.Z}};function R(e){var t,s,n,r,c,o;let{roomId:d,tasks:x,members:m,userId:h,isAdmin:p,onRefresh:f}=e,[b,j]=(0,l.useState)(null),[N,w]=(0,l.useState)(null),[y,k]=(0,l.useState)(null),[C,Z]=(0,l.useState)(null),[S,D]=(0,l.useState)(null),[A,R]=(0,l.useState)({summary:"",breaking:!1,content:""}),{on:U}=u(d,h);(0,l.useEffect)(()=>U("event.new",e=>{["task.status.updated","task.assigned"].includes(e.type)&&f()}),[U,f]),x.flatMap(e=>{var t;return null!==(t=e.contractDeps)&&void 0!==t?t:[]}).map(e=>e.contract).filter((e,t,s)=>e&&s.findIndex(t=>(null==t?void 0:t.id)===e.id)===t);let _=async(e,t)=>{await i.lC.assign(e,t),Z(null),f()},P=async e=>{k((await i.Vp.get(e)).data),w(e)},T=async e=>{await i.Vp.publish(e,A),D(null),R({summary:"",breaking:!1,content:""}),f()},B=e=>x.filter(t=>t.status===e);return(0,a.jsxs)("div",{className:"h-full flex overflow-hidden",children:[(0,a.jsx)("div",{className:"flex-1 overflow-x-auto overflow-y-auto p-4",children:(0,a.jsx)("div",{className:"flex gap-3 min-w-max h-full",children:Object.entries(M).map(e=>{let[t,s]=e,l=s.icon,n=B(t);return(0,a.jsxs)("div",{className:"w-64 flex-shrink-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-3 px-1",children:[(0,a.jsx)(l,{className:"w-3.5 h-3.5 text-slate-400"}),(0,a.jsx)("span",{className:"text-xs font-medium text-slate-400",children:s.label}),(0,a.jsx)("span",{className:"badge bg-slate-800 text-slate-400 ml-auto",children:n.length})]}),(0,a.jsx)("div",{className:"space-y-2",children:n.map(e=>{var t;return(0,a.jsxs)("div",{className:(0,g.Z)("card p-3 cursor-pointer hover:border-brand-500/30 transition-all",(null==b?void 0:b.id)===e.id&&"border-brand-500/50"),onClick:()=>j((null==b?void 0:b.id)===e.id?null:e),children:[(0,a.jsx)("p",{className:"text-sm text-white font-medium leading-tight",children:e.title}),e.assignedUser&&(0,a.jsxs)("p",{className:"text-xs text-slate-500 mt-1.5",children:["\uD83D\uDC64 ",e.assignedUser.name]}),e.blockedReason&&(0,a.jsxs)("p",{className:"text-xs text-red-400 mt-1 flex items-start gap-1",children:[(0,a.jsx)(I.Z,{className:"w-3 h-3 mt-0.5 flex-shrink-0"}),e.blockedReason]}),(null===(t=e.toDependencies)||void 0===t?void 0:t.length)>0&&(0,a.jsx)("div",{className:"mt-2 flex flex-wrap gap-1",children:e.toDependencies.map(e=>{var t,s;let l=x.find(t=>t.id===e.fromTaskId);return l?(0,a.jsxs)("span",{className:(0,g.Z)("badge text-xs",null!==(s=null===(t=M[l.status])||void 0===t?void 0:t.color)&&void 0!==s?s:"bg-slate-700 text-slate-400"),children:["← ",l.title.slice(0,16)]},e.id):null})}),(0,a.jsx)("p",{className:"text-xs text-slate-600 mt-2",children:(0,v.Q)(new Date(e.updatedAt),{addSuffix:!0})})]},e.id)})})]},t)})})}),b&&(0,a.jsxs)("div",{className:"w-80 border-l border-white/5 flex flex-col overflow-y-auto flex-shrink-0",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-white/5",children:[(0,a.jsx)("button",{onClick:()=>j(null),className:"text-xs text-slate-500 hover:text-white mb-3",children:"✕ Close"}),(0,a.jsx)("h3",{className:"font-semibold text-white mb-1",children:b.title}),(0,a.jsx)("span",{className:"badge text-xs ".concat(null===(t=M[b.status])||void 0===t?void 0:t.color),children:null===(s=M[b.status])||void 0===s?void 0:s.label})]}),(0,a.jsxs)("div",{className:"p-4 space-y-4 flex-1",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-slate-500 mb-1",children:"Description"}),(0,a.jsx)("p",{className:"text-sm text-slate-300",children:b.description})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-slate-500 mb-1",children:"Acceptance Criteria"}),(0,a.jsx)("pre",{className:"text-xs text-slate-300 whitespace-pre-wrap font-sans",children:b.acceptanceCriteria})]}),p&&!b.assignedUserId&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-slate-500 mb-2",children:"Assign to"}),(0,a.jsx)("div",{className:"space-y-1",children:m.map(e=>{var t;return(0,a.jsxs)("button",{onClick:()=>_(b.id,e.userId),className:"w-full text-left px-3 py-2 rounded-lg bg-surface-900 hover:bg-brand-600/20 text-sm text-slate-300 hover:text-white transition-colors",children:[null===(t=e.user)||void 0===t?void 0:t.name," ",(0,a.jsxs)("span",{className:"text-slate-600 text-xs",children:["(",e.role,")"]})]},e.userId)})})]}),(null===(n=b.contractDeps)||void 0===n?void 0:n.length)>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-slate-500 mb-2",children:"Contract Dependencies"}),(0,a.jsx)("div",{className:"space-y-1",children:b.contractDeps.map(e=>e.contract&&(0,a.jsxs)("button",{onClick:()=>P(e.contractId),className:"w-full text-left px-3 py-2 rounded-lg bg-surface-900 hover:bg-brand-600/10 text-xs flex items-center gap-2 text-slate-300",children:[(0,a.jsx)(E.Z,{className:"w-3.5 h-3.5 text-brand-400"}),e.contract.name,(0,a.jsx)("span",{className:"text-slate-600 ml-auto",children:e.dependencyType})]},e.id))})]})]})]}),y&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"card w-full max-w-2xl max-h-[80vh] flex flex-col",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-white/5 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-white",children:y.name}),(0,a.jsxs)("p",{className:"text-xs text-slate-500",children:[y.type," \xb7 ",null!==(o=null===(r=y.versions)||void 0===r?void 0:r.length)&&void 0!==o?o:0," versions"]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[p&&(0,a.jsx)("button",{onClick:()=>{var e,t,s;D(y.id),R({summary:"",breaking:!1,content:null!==(s=null===(t=y.versions)||void 0===t?void 0:null===(e=t[0])||void 0===e?void 0:e.content)&&void 0!==s?s:""})},className:"btn-primary text-xs",children:"Publish New Version"}),(0,a.jsx)("button",{onClick:()=>{k(null),w(null)},className:"btn-ghost text-xs",children:"Close"})]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:null===(c=y.versions)||void 0===c?void 0:c.map(e=>(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsxs)("span",{className:"text-xs font-medium text-white",children:["v",e.version]}),e.breaking&&(0,a.jsx)("span",{className:"badge bg-red-600/20 text-red-300",children:"Breaking"}),(0,a.jsx)("span",{className:"text-xs text-slate-500 ml-auto",children:(0,v.Q)(new Date(e.createdAt),{addSuffix:!0})})]}),(0,a.jsx)("p",{className:"text-xs text-slate-400 mb-2",children:e.summary}),(0,a.jsx)("pre",{className:"bg-surface-900 p-3 rounded-lg text-xs text-slate-300 overflow-x-auto",children:e.content})]},e.id))})]})}),S&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"card p-6 w-full max-w-lg",children:[(0,a.jsx)("h3",{className:"font-semibold text-white mb-4",children:"Publish New Contract Version"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs text-slate-400 block mb-1",children:"Summary"}),(0,a.jsx)("input",{className:"input",value:A.summary,onChange:e=>R(t=>({...t,summary:e.target.value})),placeholder:"What changed?"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs text-slate-400 block mb-1",children:"Content"}),(0,a.jsx)("textarea",{className:"input font-mono text-xs resize-none",rows:10,value:A.content,onChange:e=>R(t=>({...t,content:e.target.value}))})]}),(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:A.breaking,onChange:e=>R(t=>({...t,breaking:e.target.checked})),className:"rounded"}),(0,a.jsx)("span",{className:"text-sm text-slate-300",children:"Breaking change"})]}),(0,a.jsxs)("div",{className:"flex gap-2 pt-1",children:[(0,a.jsx)("button",{onClick:()=>D(null),className:"btn-ghost flex-1",children:"Cancel"}),(0,a.jsx)("button",{onClick:()=>T(S),className:"btn-primary flex-1",disabled:!A.summary||!A.content,children:"Publish"})]})]})]})})]})}var U=s(548),_=s(3349),P=s(743),T=s(6548),B=s(3025),O=s(5731);let V={decision:{label:"Decision",icon:U.Z,color:"text-blue-400 bg-blue-400/10"},contract_change:{label:"Contract Change",icon:_.Z,color:"text-purple-400 bg-purple-400/10"},task_update:{label:"Task Update",icon:P.Z,color:"text-green-400 bg-green-400/10"},integration:{label:"Integration",icon:T.Z,color:"text-brand-400 bg-brand-400/10"},blocker:{label:"Blocker",icon:I.Z,color:"text-red-400 bg-red-400/10"},summary:{label:"Summary",icon:B.Z,color:"text-slate-400 bg-slate-400/10"}};function W(e){let{roomId:t,userId:s}=e,[n,r]=(0,l.useState)([]),[c,o]=(0,l.useState)(!0),[d,x]=(0,l.useState)(""),[m,h]=(0,l.useState)(""),[f,b]=(0,l.useState)(null),{on:j}=u(t,null!=s?s:null),N=(e,s)=>{o(!0),i.ug.list(t,e,s).then(e=>r(e.data)).catch(console.error).finally(()=>o(!1))};(0,l.useEffect)(()=>{N()},[t]),(0,l.useEffect)(()=>j("event.new",e=>{"notebook.entry.added"===e.type&&N(d,m)}),[j,d,m]);let w=()=>N(d,m);return(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[(0,a.jsxs)("div",{className:"px-4 py-3 border-b border-white/5 flex gap-3 flex-shrink-0 flex-wrap",children:[(0,a.jsxs)("div",{className:"relative flex-1 min-w-48",children:[(0,a.jsx)(O.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-slate-500"}),(0,a.jsx)("input",{className:"input pl-8",placeholder:"Search notebook...",value:d,onChange:e=>x(e.target.value),onKeyDown:e=>"Enter"===e.key&&w()})]}),(0,a.jsx)("div",{className:"flex gap-1 flex-wrap",children:["",...Object.keys(V)].map(e=>{var t;return(0,a.jsx)("button",{onClick:()=>{h(e),N(d,e)},className:(0,g.Z)("text-xs px-3 py-1.5 rounded-lg transition-colors",m===e?"bg-brand-600 text-white":"bg-surface-800 text-slate-400 hover:text-white"),children:e?null===(t=V[e])||void 0===t?void 0:t.label:"All"},e)})})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto px-4 py-4",children:c?(0,a.jsx)("div",{className:"flex justify-center pt-8",children:(0,a.jsx)(p.Z,{className:"w-5 h-5 animate-spin text-brand-500"})}):0===n.length?(0,a.jsxs)("div",{className:"text-center text-slate-500 text-sm pt-8",children:[(0,a.jsx)(U.Z,{className:"w-8 h-8 text-slate-600 mx-auto mb-2"}),"No entries yet. Entries are added automatically as your team works."]}):(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"absolute left-4 top-0 bottom-0 w-px bg-white/5"}),(0,a.jsx)("div",{className:"space-y-4 pl-10",children:n.map(e=>{var t,s,l,n,r,i,c;let o=null!==(c=V[e.category])&&void 0!==c?c:V.summary,d=o.icon,x=f===e.id;return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:(0,g.Z)("absolute -left-[2.25rem] top-3 w-5 h-5 rounded-full flex items-center justify-center",o.color),children:(0,a.jsx)(d,{className:"w-3 h-3"})}),(0,a.jsx)("div",{className:"card p-4",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1 flex-wrap",children:[(0,a.jsx)("span",{className:(0,g.Z)("badge text-xs",o.color),children:o.label}),(0,a.jsx)("span",{className:"text-xs text-slate-500",children:(0,v.Q)(new Date(e.createdAt),{addSuffix:!0})})]}),(0,a.jsx)("h4",{className:"text-sm font-medium text-white",children:e.title}),x&&(0,a.jsxs)("div",{className:"mt-3 prose-dark",children:[(0,a.jsx)("p",{className:"text-sm text-slate-300 whitespace-pre-wrap",children:e.content}),((null===(s=e.references)||void 0===s?void 0:null===(t=s.taskIds)||void 0===t?void 0:t.length)>0||(null===(n=e.references)||void 0===n?void 0:null===(l=n.contractIds)||void 0===l?void 0:l.length)>0)&&(0,a.jsxs)("div",{className:"mt-3 flex gap-2 flex-wrap",children:[null===(r=e.references.taskIds)||void 0===r?void 0:r.map(e=>(0,a.jsxs)("span",{className:"badge bg-surface-900 text-slate-400 font-mono text-xs",children:["task:",e.slice(0,8)]},e)),null===(i=e.references.contractIds)||void 0===i?void 0:i.map(e=>(0,a.jsxs)("span",{className:"badge bg-purple-600/10 text-purple-400 font-mono text-xs",children:["contract:",e.slice(0,8)]},e))]})]})]}),(0,a.jsx)("button",{onClick:()=>b(x?null:e.id),className:"text-xs text-slate-500 hover:text-white transition-colors flex-shrink-0",children:x?"Collapse":"Expand"})]})})]},e.id)})})]})})]})}var J=s(3989),L=s(113),K=s(3890),Q=s(5729);let z=[{id:"master",label:"Master",icon:h.Z},{id:"agent",label:"My Agent",icon:J.Z},{id:"tasks",label:"Tasks",icon:L.Z},{id:"notebook",label:"Notebook",icon:U.Z}];function X(){var e,t,s;let{id:c}=(0,n.useParams)(),{user:o,loading:d,logout:x}=(0,r.a)(),m=(0,n.useRouter)(),[h,f]=(0,l.useState)(null),[b,v]=(0,l.useState)(!0),[N,w]=(0,l.useState)("master"),[y,k]=(0,l.useState)([]),[C,S]=(0,l.useState)(!1),[D,A]=(0,l.useState)(""),{on:E}=u(c,null!==(t=null==o?void 0:o.id)&&void 0!==t?t:null),M=(0,l.useCallback)(async()=>{try{let e=await i.I2.get(c);f(e.data)}catch(e){console.error(e)}finally{v(!1)}},[c]);(0,l.useEffect)(()=>{if(!d&&!o){m.push("/login");return}o&&M()},[o,d,M,m]),(0,l.useEffect)(()=>{let e=E("event.new",e=>{["master.integration.alert","master.impact.alert","master.security.alert","member.joined"].includes(e.type)&&(k(t=>[{...e,id:e.id},...t].slice(0,5)),setTimeout(()=>{k(t=>t.filter(t=>t.id!==e.id))},1e4)),["task.status.updated","task.assigned","contract.published","notebook.entry.added","member.joined"].includes(e.type)&&M()});return()=>{"function"==typeof e&&e()}},[E,M]);let U=async()=>{try{let e=await i.I2.createInvite(c);A(e.data.url),S(!0)}catch(e){console.error(e)}};if(d||b)return(0,a.jsx)("div",{className:"flex items-center justify-center h-screen bg-surface-950",children:(0,a.jsx)(p.Z,{className:"animate-spin w-8 h-8 text-brand-500"})});if(!h||!o)return null;let _="owner"===h.myRole||"admin"===h.myRole;return(0,a.jsxs)("div",{className:"h-screen bg-surface-950 flex flex-col overflow-hidden",children:[(0,a.jsxs)("header",{className:"border-b border-white/5 px-4 py-3 flex items-center gap-4 flex-shrink-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,a.jsx)("div",{className:"w-7 h-7 bg-brand-600 rounded-lg flex items-center justify-center text-xs font-bold flex-shrink-0",children:"D"}),(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsx)("h1",{className:"font-semibold text-white text-sm truncate",children:h.title}),(0,a.jsx)("p",{className:"text-xs text-slate-500 truncate hidden sm:block",children:h.goal})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1 ml-auto",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 text-xs text-slate-400 mr-2",children:[(0,a.jsx)(J.Z,{className:"w-3.5 h-3.5"}),null!==(s=null===(e=h.memberships)||void 0===e?void 0:e.length)&&void 0!==s?s:0]}),_&&(0,a.jsxs)("button",{onClick:U,className:"btn-ghost flex items-center gap-1.5 text-xs",children:[(0,a.jsx)(K.Z,{className:"w-3.5 h-3.5"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Invite"})]}),(0,a.jsxs)("button",{onClick:x,className:"btn-ghost flex items-center gap-1.5 text-xs",children:[(0,a.jsx)(Q.Z,{className:"w-3.5 h-3.5"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:o.name})]})]})]}),y.length>0&&(0,a.jsx)("div",{className:"bg-amber-500/10 border-b border-amber-500/20 px-4 py-2 space-y-1 flex-shrink-0",children:y.map(e=>{var t,s,l;return(0,a.jsxs)("div",{className:(0,g.Z)("flex items-start gap-2 text-xs","master.security.alert"===e.type?"text-red-300":"text-amber-300"),children:[(0,a.jsx)(I.Z,{className:(0,g.Z)("w-3.5 h-3.5 mt-0.5 flex-shrink-0","master.security.alert"===e.type?"text-red-300":"text-amber-300")}),(0,a.jsx)("span",{children:"string"==typeof(null===(t=e.payload)||void 0===t?void 0:t.message)?e.payload.message:JSON.stringify((null===(s=e.payload)||void 0===s?void 0:s.message)||(null===(l=e.payload)||void 0===l?void 0:l.summary))}),(0,a.jsx)("button",{onClick:()=>k(t=>t.filter(t=>t.id!==e.id)),className:"ml-auto text-amber-500 hover:text-white",children:"✕"})]},e.id)})}),(0,a.jsx)("nav",{className:"flex border-b border-white/5 flex-shrink-0",children:z.map(e=>{let{id:t,label:s,icon:l}=e;return(0,a.jsxs)("button",{onClick:()=>w(t),className:(0,g.Z)("flex items-center gap-2 px-4 py-3 text-sm font-medium border-b-2 transition-colors",N===t?"border-brand-500 text-brand-400":"border-transparent text-slate-400 hover:text-white"),children:[(0,a.jsx)(l,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:s})]},t)})}),(0,a.jsxs)("div",{className:"flex-1 overflow-hidden",children:["master"===N&&(0,a.jsx)(j,{roomId:c,userId:o.id,userName:o.name,isAdmin:_,tasks:h.tasks}),"agent"===N&&(0,a.jsx)(Z,{roomId:c,userId:o.id,userName:o.name,tasks:h.tasks,members:h.memberships}),"tasks"===N&&(0,a.jsx)(R,{roomId:c,tasks:h.tasks,members:h.memberships,userId:o.id,isAdmin:_,onRefresh:M}),"notebook"===N&&(0,a.jsx)(W,{roomId:c})]}),C&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"card p-6 w-full max-w-md",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-white mb-3",children:"Invite Link"}),(0,a.jsx)("p",{className:"text-sm text-slate-400 mb-3",children:"Share this link with collaborators (expires in 7 days):"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{className:"input flex-1 text-xs",value:D,readOnly:!0}),(0,a.jsx)("button",{className:"btn-primary text-xs px-3",onClick:()=>navigator.clipboard.writeText(D),children:"Copy"})]}),(0,a.jsx)("button",{onClick:()=>S(!1),className:"btn-ghost w-full mt-3",children:"Close"})]})})]})}},5118:function(e,t,s){"use strict";s.d(t,{Hh:function(){return m},I2:function(){return i},Mp:function(){return d},Vp:function(){return o},iJ:function(){return r},lC:function(){return c},ug:function(){return x}});var a=s(3908);let l=s(4859).env.NEXT_PUBLIC_API_URL||"http://localhost:4000",n=a.Z.create({baseURL:l,withCredentials:!0,headers:{"Content-Type":"application/json"}}),r={register:(e,t,s)=>n.post("/auth/register",{name:e,email:t,password:s}),login:(e,t)=>n.post("/auth/login",{email:e,password:t}),logout:()=>n.post("/auth/logout"),me:()=>n.get("/auth/me")},i={list:()=>n.get("/rooms"),get:e=>n.get("/rooms/".concat(e)),create:(e,t)=>n.post("/rooms",{title:e,goal:t}),plan:e=>n.post("/rooms/".concat(e,"/plan")),createInvite:e=>n.post("/rooms/".concat(e,"/invites"))},c={get:e=>n.get("/tasks/".concat(e)),assign:(e,t)=>n.post("/tasks/".concat(e,"/assign"),{assignedUserId:t}),updateStatus:(e,t,s)=>n.post("/tasks/".concat(e,"/status"),{status:t,blockedReason:s})},o={get:e=>n.get("/contracts/".concat(e)),propose:(e,t)=>n.post("/contracts/".concat(e,"/propose"),t),publish:(e,t)=>n.post("/contracts/".concat(e,"/publish"),t)},d={list:(e,t)=>n.get("/rooms/".concat(e,"/messages?channel=").concat(t)),sendMaster:(e,t,s)=>n.post("/rooms/".concat(e,"/messages/master"),{content:t,sharedFromMessageId:s}),sendWorker:(e,t)=>n.post("/rooms/".concat(e,"/messages/worker"),{content:t})},x={list:(e,t,s)=>n.get("/rooms/".concat(e,"/notebook"),{params:{q:t,category:s}}),create:(e,t)=>n.post("/rooms/".concat(e,"/notebook"),t)},m={join:e=>n.post("/invites/".concat(e,"/join"))}},4382:function(e,t,s){"use strict";s.d(t,{AuthProvider:function(){return i},a:function(){return c}});var a=s(7573),l=s(7653),n=s(5118);let r=(0,l.createContext)(null);function i(e){let{children:t}=e,[s,i]=(0,l.useState)(null),[c,o]=(0,l.useState)(!0);(0,l.useEffect)(()=>{n.iJ.me().then(e=>i(e.data)).catch(()=>i(null)).finally(()=>o(!1))},[]);let d=(0,l.useCallback)(async(e,t)=>{i((await n.iJ.login(e,t)).data)},[]),x=(0,l.useCallback)(async(e,t,s)=>{i((await n.iJ.register(e,t,s)).data)},[]),m=(0,l.useCallback)(async()=>{await n.iJ.logout(),i(null)},[]);return(0,a.jsx)(r.Provider,{value:{user:s,loading:c,login:d,register:x,logout:m},children:t})}function c(){let e=(0,l.useContext)(r);if(!e)throw Error("useAuth must be used within AuthProvider");return e}}},function(e){e.O(0,[908,551,293,528,744],function(){return e(e.s=693)}),_N_E=e.O()}]);